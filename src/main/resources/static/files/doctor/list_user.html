<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>用户信息列表</title>
  <link rel="stylesheet" type="text/css" href="../../css/doctor/list_user.css">
</head>
<style>
  /* 整体布局 */
  body {
    font-family: "Microsoft YaHei", sans-serif;
    margin: 0;
    padding: 20px;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  }

  /* 其他样式保持不变 */
  /* ... */
</style>
<body bgcolor="#ffffff">
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="pad5">
  <tr>
    <td valign="top" align="left" class="pad5">
      <table width="100%" border="0" cellspacing="0" cellpadding="0" class="dqbg margb5">
        <tr>
          <td width="2%" align="right" class="pad05">
            <img src="../../images/img2.gif" width="16" height="16">
          </td>
          <td width="98%" align="left" class="lan13b">医生管理 > 医生信息管理</td>
        </tr>
      </table>
      <form id="searchForm" action="list_user.html" method="get">
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="dqbg margb5">
          <tr>
            <td align="center" class="lan13b">
              医生姓名： <input name="ysxm" id="ysxm" value="" maxlength="32" />
              <input type="submit" name="button" value="查询" class="button">
            </td>
          </tr>
        </table>
      </form>
      <table border="0" cellspacing="0" cellpadding="0" class="margb5">
        <tr>
          <td width="61" align="left" class="padr5">
            <img src="../../images/pic-13.jpg" alt="添加" onclick="window.location.href='adduser.html'">
          </td>
        </tr>
      </table>
      <table width="100%" border="0" cellspacing="1" cellpadding="0" class="table-border margb5">
        <tr>
          <td colspan="12" align="left" class="tabbg">
            <img src="../../images/main_pic_1.gif" align="absmiddle" width="16" height="16">&nbsp;<span class="lan13b"></span>
          </td>
        </tr>
        <tr>
          <th width="3%" nowrap class="COLLECTION">编号</th>
          <th width="3%" nowrap class="COLLECTION">医生编号</th>
          <th width="3%" nowrap class="COLLECTION">姓名</th>
          <th width="3%" nowrap class="COLLECTION">性别</th>
          <th width="5%" nowrap class="COLLECTION">职称</th>
          <th width="5%" nowrap class="COLLECTION">职务</th>
          <th width="7%" nowrap class="COLLECTION">科别</th>
          <th width="7%" nowrap class="COLLECTION">出生日期</th>
          <th width="7%" nowrap class="COLLECTION">工作日期</th>
          <th width="7%" nowrap class="COLLECTION">管理</th>
        </tr>
        <tbody id="doctorTableBody"></tbody>
      </table>
    </td>
  </tr>
</table>
<script src="../../js/axios.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    fetchData();

    document.getElementById('searchForm').addEventListener('submit', function (event) {
      event.preventDefault();
      const doctorName = document.getElementById('ysxm').value.trim();
      let queryParams = doctorName ? `name=${encodeURIComponent(doctorName)}` : '';
      axios.get(`http://localhost:8080/doctor/selectDoctor?${queryParams}`)
              .then(response => handleResponse(response))
              .catch(error => handleError(error));
    });
  });

  function fetchData() {
    axios.get('http://localhost:8080/doctor/selectDoctor')
            .then(response => handleResponse(response))
            .catch(error => handleError(error));
  }

  function handleResponse(response) {
    if (response.headers['content-type'].includes('application/json')) {
      const data = response.data.data;
      populateTable(data);
    }
  }

  function handleError(error) {
    console.error('请求失败:', error);
  }

  function populateTable(data) {
    const tableBody = document.getElementById('doctorTableBody');
    tableBody.innerHTML = '';
    data.forEach((item, index) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${index + 1}</td>
        <td>${item.number}</td>
        <td>${item.name}</td>
        <td>${item.sex}</td>
        <td>${item.zhicheng}</td>
        <td>${item.zhiwu}</td>
        <td>${item.kebie}</td>
        <td>${item.birthtime}</td>
        <td>${item.worktime}</td>
        <td>
          <a href="modifyuser.html?id=${item.id}">编辑</a> |
          <a href="javascript:void(0);" onclick="deleteUser(${item.id})">删除</a>
        </td>
      `;
      tableBody.appendChild(row);
    });
  }

  // 定义删除用户的函数
  function deleteUser(userId) {
    if (confirm('确定要删除该医生吗？')) {
      axios.delete(`http://localhost:8080/doctor/delete/${userId}`)
              .then(response => {
                if (response.data.code === 1) {
                  alert('删除成功');
                  fetchData(); // 重新加载数据
                } else {
                  alert('删除失败: ' + response.data.msg);
                }
              })
              .catch(error => {
                console.error('删除失败：', error);
                alert('删除失败，请稍后重试');
              });
    }
  }
</script>
</body>
</html>