<!DOCTYPE html>
<html lang="en">
<script src="../../js/self.js" ></script>
<head>
  <meta charset="UTF-8">
  <title>用户信息列表</title>
  <link rel="stylesheet" type="text/css" href="../../css/doctor/list_user.css">

</head>
<style>
  /* 整体布局 */
  body {
    font-family: "Microsoft YaHei", sans-serif;
    margin: 0;
    padding: 20px;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  }

  /* 导航路径 */
  .nav-path {
    background: white;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
  }

  .nav-path img {
    margin-right: 10px;
  }

  .nav-path .path-text {
    color: #2c3e50;
    font-weight: bold;
  }

  /* 搜索区域 */
  .search-area {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    text-align: center;
  }

  #ysxm {
    padding: 10px 15px;
    border: 2px solid #e1e8ed;
    border-radius: 6px;
    width: 250px;
    margin-right: 10px;
    transition: all 0.3s ease;
  }

  #ysxm:focus {
    border-color: #3498db;
    box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
    outline: none;
  }

  /* 按钮样式 */
  .button {
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    color: white;
    border: none;
    padding: 10px 25px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
  }

  .button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(52,152,219,0.3);
  }

  /* 添加按钮 */
  .add-button {
    margin-bottom: 20px;
  }

  .add-button img {
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .add-button img:hover {
    transform: scale(1.1);
  }

  /* 表格样式 */
  .table-border {
    width: 100%;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }

  .table-border th {
    background: #3498db;
    color: white;
    padding: 15px;
    text-align: left;
  }

  .table-border td {
    padding: 12px 15px;
    border-bottom: 1px solid #e1e8ed;
  }

  .table-border tr:hover {
    background-color: #f8fafc;
  }

  /* 操作链接 */
  .action-links a {
    color: #3498db;
    text-decoration: none;
    margin: 0 5px;
    padding: 5px 10px;
    border-radius: 4px;
    transition: all 0.3s ease;
  }

  .action-links a:hover {
    background: #3498db;
    color: white;
  }

  /* 表格标题行 */
  .tabbg {
    background: #f8fafc;
    padding: 10px;
    border-bottom: 2px solid #3498db;
  }

  /* 状态标签 */
  .status-tag {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
  }

  .male {
    background: #e8f4fd;
    color: #3498db;
  }

  .female {
    background: #fce7f3;
    color: #d53f8c;
  }

  /* 响应式设计 */
  @media (max-width: 768px) {
    .search-area {
      padding: 15px;
    }

    #ysxm {
      width: 100%;
      margin-bottom: 10px;
    }

    .table-border {
      display: block;
      overflow-x: auto;
    }
  }
</style>
<body bgcolor="#ffffff">
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="pad5">
  <tr>
    <td valign="top" align="left" class="pad5">
      <table width="100%" border="0" cellspacing="0" cellpadding="0" class="dqbg margb5">
        <tr>
          <td width="2%" align="right" class="pad05">
            <img src="../../images/img2.gif" width="16" height="16">
          </td>
          <td width="98%" align="left" class="lan13b">医生管理 > 医生信息管理</td>
        </tr>
      </table>
      <form id="searchForm" action="list_user.html" method="get">
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="dqbg margb5">
          <tr>
            <td align="center" class="lan13b">
              医生姓名： <input name="ysxm" id="ysxm" value="" maxlength="32" />
              <input type="submit" name="button" value="查询" class="button">
            </td>
          </tr>
        </table>
      </form>
      <table border="0" cellspacing="0" cellpadding="0" class="margb5">
        <tr>
          <td width="61" align="left" class="padr5">
            <img src="../../images/pic-13.jpg" alt="添加" onclick="window.location.href='adduser.html'">
          </td>
        </tr>
      </table>
      <table width="100%" border="0" cellspacing="1" cellpadding="0" class="table - border margb5">
        <tr>
          <td colspan="12" align="left" class="tabbg">
            <img src="../../images/main_pic_1.gif" align="absmiddle" width="16" height="16">&nbsp;<span class="lan13b"></span>
          </td>
        </tr>
        <tr>
          <th width="3%" nowrap class="COLLECTION">
            编号
          </th>
          <th width="3%" nowrap class="COLLECTION">
            医生编号
          </th>
          <th width="3%" nowrap class="COLLECTION">
            姓名
          </th>
          <th width="3%" nowrap class="COLLECTION">
            性别
          </th>
          <th width="5%" nowrap class="COLLECTION">职称</th>
          <th width="5%" nowrap class="COLLECTION">职务</th>
          <th width="7%" nowrap class="COLLECTION">
            科别
          </th>
          <th width="7%" nowrap class="COLLECTION">
            出生日期
          </th>
          <th width="7%" nowrap class="COLLECTION">
            工作日期
          </th>
          <th width="7%" nowrap class="COLLECTION">
            管理
          </th>
        </tr>
        <!-- 这里后续通过JavaScript动态添加数据行 -->
        <tbody id="doctorTableBody"></tbody>
      </table>

      <form action="list_user.html" method="get">
        <tr>
          <td colspan="11" align="right" class="tabbg hei12">
            <!-- 这里通过JavaScript动态控制分页链接显示 -->
          </td>
        </tr>
      </form>
    </td>
  </tr>
</table>
</body>
</html>
<script src="../../js/axios.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // 页面加载完成后自动发起请求
    fetchData();

    // 表单提交时也发起请求
    document.getElementById('searchForm').addEventListener('submit', function (event) {
      event.preventDefault(); // 阻止表单默认提交行为

      const doctorName = document.getElementById('ysxm').value.trim();

      // 构建查询参数
      let queryParams = '';
      if (doctorName) {
        queryParams = `name=${encodeURIComponent(doctorName)}`;
      }

      // 发送 axios 请求
      axios({
        url: `http://localhost:8080/doctor/selectDoctor?${queryParams}`,
        method: "get"
      }).then(response => {
        handleResponse(response);
      }).catch(error => {
        handleError(error);
      });
    });
  });

  function fetchData() {
    // 默认查询参数可以为空
    const defaultQueryParams = '';

    axios({
      url: `http://localhost:8080/doctor/selectDoctor?${defaultQueryParams}`,
      method: "get"
    }).then(response => {
      handleResponse(response);
    }).catch(error => {
      handleError(error);
    });
  }


  function handleResponse(response) {
    const contentType = response.headers['content-type'];
    console.log(typeof contentType)
    console.log(contentType)
    if (contentType.includes('application/json')) {
      console.log('处理JSON数据:', response.data);
      // 提取后端返回对象中的data数组
      const data = response.data.data;
      console.log(data)
      // 在这里动态添加数据行到表格中
      populateTable(data);
    } else if (contentType.includes('application/xml')) {
      // 处理XML数据，可能需要使用xml2js等库进行解析
      console.log('处理XML数据:', response.data);
    } else {
      console.log('处理其他类型数据:', response.data);
    }
  }

  function handleError(error) {
    if (error.response && error.response.status === 406) {
      console.log('HTTP 406错误：服务器返回的内容类型不被接受');
    } else {
      console.error('请求失败:', error);
    }
  }

  function populateTable(data) {
    // 假设 data 是一个包含医生信息的数组
    const tableBody = document.getElementById('doctorTableBody');
    // 清空现有表格内容
    tableBody.innerHTML = '';

    data.forEach((item, index) => {
      const row = document.createElement('tr');
      row.innerHTML = `
      <td>${index + 1}</td>
      <td>${item.number}</td>
      <td>${item.name}</td>
      <td>${item.sex}</td>
      <td>${item.zhicheng}</td>
      <td>${item.zhiwu}</td>
      <td>${item.kebie}</td>
      <td>${item.birthtime}</td>
      <td>${item.worktime}</td>
      <td><a href="modifyuser.html?id=${item.id}">编辑</a> | <a href="deleteuser.html?id=${item.id}" onclick="deleteUser(${item.id})">删除</a></td>
    `;
      tableBody.appendChild(row);
    });
  }

</script>